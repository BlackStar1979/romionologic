{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://romionologic.neocities.org/schemas/romion-sim.alpha.json",
  "title": "ROMION SIM Experiment (alpha)",
  "type": "object",
  "required": ["spec_version","hypergraph","rules","probes","run"],
  "properties": {
    "spec_version": { "type":"string", "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z.-]+)?$" },
    "metadata": {
      "type":"object",
      "properties":{
        "name":{"type":"string"},
        "author":{"type":"string"},
        "created":{"type":"string","format":"date-time"},
        "description":{"type":"string"}
      },
      "additionalProperties": false
    },
    "hypergraph": {
      "type":"object",
      "required":["edges"],
      "properties":{
        "nodes": {
          "type":"array",
          "items": { "anyOf":[{"type":"string"},{"type":"integer"}] },
          "uniqueItems": true
        },
        "edges": {
          "type":"array",
          "items":{
            "type":"object",
            "required":["nodes"],
            "properties":{
              "nodes":{
                "type":"array",
                "minItems": 2,
                "items":{"anyOf":[{"type":"string"},{"type":"integer"}]}
              },
              "attrs":{"type":"object","additionalProperties": true}
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "rules": {
      "type":"array",
      "minItems": 1,
      "items":{
        "type":"object",
        "required":["name","when","do"],
        "properties":{
          "name":{"type":"string"},
          "when":{
            "type":"object",
            "properties":{
              "match":{"type":"object","additionalProperties": true},
              "guard":{"type":"object","additionalProperties": true}
            },
            "additionalProperties": false
          },
          "do":{
            "type":"object",
            "properties":{
              "add":{"type":"array","items":{"type":"object","properties":{"nodes":{"type":"array","items":{"type":"string"},"minItems":2},"type":{"type":"string"},"attrs":{"type":"object"}},"required":["nodes"],"additionalProperties":false}},
              "remove":{"type":"array","items":{"type":"object","properties":{"nodes":{"type":"array","items":{"type":"string"},"minItems":2},"type":{"type":"string"}},"required":["nodes"],"additionalProperties":false}}
            },
            "additionalProperties": false
          },
          "invariants": {
            "type":"object",
            "properties":{
              "preserve_loop_class":{"type":"boolean"},
              "bounded_degree":{"type":"integer","minimum":1}
            },
            "additionalProperties": true
          },
          "weight":{"type":"number","minimum":0}
        },
        "additionalProperties": false
      }
    },
    "probes": {
      "type":"array",
      "items": { "anyOf":[
        {"type":"string","enum":["loops","degree_dist","entropy","spectrum"]},
        {"type":"object","properties":{"name":{"type":"string"},"params":{"type":"object"}},"required":["name"],"additionalProperties": false}
      ]}
    },
    "run": {
      "type":"object",
      "required":["steps","schedule"],
      "properties":{
        "steps":{"type":"integer","minimum":1},
        "seed":{"type":"integer"},
        "schedule":{"type":"string","enum":["random-local","round-robin","priority"]},
        "export":{"type":"object","properties":{"metrics":{"type":"string"},"history":{"type":"string"},"final":{"type":"string"}},"additionalProperties": false},
        "metric":{"type":"object","properties":{"name":{"type":"string","default":"d_em"},"costs":{"type":"object"}},"additionalProperties": false}
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://romionologic.neocities.org/schemas/romion-sim.alpha.json",
  "title": "ROMION SIM Experiment (alpha)",
  "type": "object",
  "required": ["spec_version","hypergraph","rules","probes","run"],
  "properties": {
    "spec_version": { "type":"string", "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z.-]+)?$" },
    "metadata": {
      "type":"object",
      "properties":{
        "name":{"type":"string"},
        "author":{"type":"string"},
        "created":{"type":"string","format":"date-time"},
        "description":{"type":"string"}
      },
      "additionalProperties": false
    },
    "hypergraph": {
      "type":"object",
      "required":["edges"],
      "properties":{
        "nodes": {
          "type":"array",
          "items": { "anyOf":[{"type":"string"},{"type":"integer"}] },
          "uniqueItems": true
        },
        "edges": {
          "type":"array",
          "items":{
            "type":"object",
            "required":["nodes"],
            "properties":{
              "nodes":{
                "type":"array",
                "minItems": 2,
                "items":{"anyOf":[{"type":"string"},{"type":"integer"}]}
              },
              "attrs":{"type":"object","additionalProperties": true}
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "rules": {
      "type":"array",
      "minItems": 1,
      "items":{
        "type":"object",
        "required":["name","when","do"],
        "properties":{
          "name":{"type":"string"},
          "when":{
            "type":"object",
            "properties":{
              "match":{"type":"object","additionalProperties": true},
              "guard":{"type":"object","additionalProperties": true}
            },
            "additionalProperties": false
          },
          "do":{
            "type":"object",
            "properties":{
              "add":{"type":"array","items":{"type":"object","properties":{"nodes":{"type":"array","items":{"type":"string"},"minItems":2},"type":{"type":"string"},"attrs":{"type":"object"}},"required":["nodes"],"additionalProperties":false}},
              "remove":{"type":"array","items":{"type":"object","properties":{"nodes":{"type":"array","items":{"type":"string"},"minItems":2},"type":{"type":"string"}},"required":["nodes"],"additionalProperties":false}}
            },
            "additionalProperties": false
          },
          "invariants": {
            "type":"object",
            "properties":{
              "preserve_loop_class":{"type":"boolean"},
              "bounded_degree":{"type":"integer","minimum":1}
            },
            "additionalProperties": true
          },
          "weight":{"type":"number","minimum":0}
        },
        "additionalProperties": false
      }
    },
    "probes": {
      "type":"array",
      "items": { "anyOf":[
        {"type":"string","enum":["loops","degree_dist","entropy","spectrum"]},
        {"type":"object","properties":{"name":{"type":"string"},"params":{"type":"object"}},"required":["name"],"additionalProperties": false}
      ]}
    },
    "run": {
      "type":"object",
      "required":["steps","schedule"],
      "properties":{
        "steps":{"type":"integer","minimum":1},
        "seed":{"type":"integer"},
        "schedule":{"type":"string","enum":["random-local","round-robin","priority"]},
        "export":{"type":"object","properties":{"metrics":{"type":"string"},"history":{"type":"string"},"final":{"type":"string"}},"additionalProperties": false},
        "metric":{"type":"object","properties":{"name":{"type":"string","default":"d_em"},"costs":{"type":"object"}},"additionalProperties": false}
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
